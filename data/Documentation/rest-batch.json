{"text": "\n\n## Batch create objects\n\nFor sending data objects to Weaviate in bulk.\n\nThe `batch` endpoint supports classes where multi-tenancy is enabled. For example, batch creation of objects works similarly to single object creation, by passing the `tenant` parameter in the object body.\n\n### Performance\n\nImport speeds, especially for large datasets, will drastically improve when using the batching endpoint.\n\nA few points to bear in mind:\n\n1. If you use a vectorizer that improves with GPU support, make sure to enable it if possible, as it will drastically improve import.\n1. Avoid duplicate vectors for multiple data objects.\n1. Handle your errors. If you ignore them, it might lead to significant delays on import.\n1. If your import slows down after a particular number of objects (e.g. 2M), check to see if the `vectorCacheMaxObjects` in your schema is larger than the number of objects. Also, see this example.\n1. There are ways to improve your setup when using vectorizers, as we've shown in the Wikipedia demo dataset. Subscribe to our Announcements category on the forum to keep up-to-date as we publish more on this topic.\n\n### Method and URL\n\n```js\nPOST /v1/batch/objects[?consistency_level=ONE|QUORUM|ALL]\n```\n\n### Parameters\n\nThe URL supports an optional consistency level query parameter:\n\n| Name | Location | Type | Description |\n| ---- | -------- | ---- |------------ |\n| `consistency_level` | query param | string | Optional consistency level: `ONE`, `QUORUM` (default) or `ALL`. |\n\nThe POST body requires the following field:\n\n| Name | Type | Required | Description |\n| ---- | ---- | ---- | ---- |\n| `objects` | array of data objects | yes | Array of objects |\n\n### Example request\n\n\n\n\n\n\n## Batch create objects with the Python Client\n\nSpecific documentation for the Python client can be found at weaviate-python-client.readthedocs.io. Learn more about different types of batching and tip&tricks on the Weaviate Python client page.\n\n\n## Batch create references\n\nFor batch adding cross-references between data objects in bulk.\n\n### Method and URL\n\n```js\nPOST /v1/batch/references\n```\n\n### Parameters\n\nThe URL supports an optional consistency level query parameter:\n\n| Name | Location | Type | Description |\n| ---- | -------- | ---- |------------ |\n| `consistency_level` | query param | string | Optional consistency level: `ONE`, `QUORUM` (default) or `ALL`. |\n\nThe POST body is an array of elements with the following fields:\n\n| Name | Type | Required | Description |\n| ---- | ---- | -------- | ----------- |\n| `from` | Weaviate Beacon (long-form) | yes | The beacon, with the cross-reference property name at the end: `weaviate://localhost/{ClassName}/{id}/{crefPropertyName}` |\n| `to` | Weaviate Beacon (regular) | yes | The beacon, formatted as `weaviate://localhost/{ClassName}/{id}` |\n\n\n\nFor backward compatibility, you can omit the class name in the\nshort-form beacon format that is used for `to`. You can specify it as\n`weaviate://localhost/{id}`. This is, however, considered deprecated and will be\nremoved with a future release, as duplicate IDs across classes could mean that\nthis beacon is not uniquely identifiable. For the long-form beacon - used as part\nof `from` - you always need to specify the full beacon, including the reference\nproperty name.\n\n### Example request\n\n\n\n\n\nFor detailed information and instructions of batching in Python, see the weaviate.batch.Batch documentation.\n\n## Batch delete\n\nYou can use the HTTP verb `DELETE` on the `/v1/batch/objects` endpoint to delete all objects that match a particular expression. To determine if an object is a match, a where-Filter is used. The request body takes a single filter, but will delete all objects matched. It returns the number of matched objects as well as any potential errors. Note that there is a limit to how many objects can be deleted at once using this filter, which is explained below.\n\n### Maximum number of deletes per query\n\nThere is an upper limit to how many objects can be deleted using a single query. This protects against unexpected memory surges and very-long-running requests which would be prone to client-side timeouts or network interruptions. If a filter matches many objects, only the first `n` elements are deleted. You can configure `n` by setting `QUERY_MAXIMUM_RESULTS` in Weaviate's config. The default value is 10,000. Objects are deleted in the same order that they would be returned in using the same filter in a Get query. To delete more objects than the limit, run the same query multiple times, until no objects are matched anymore.\n\n\n### Dry-run before deletion\n\nYou can use the dry-run option to see which objects would be deleted using your specified filter, without deleting any objects yet. Depending on the configured verbosity, you will either receive the total count of affected objects, or a list of the affected IDs.\n\n### Method and URL\n\n```js\nDELETE /v1/batch/objects[?consistency_level=ONE|QUORUM|ALL]\n```\n\n### Parameters\n\nThe URL supports an optional consistency level query parameter:\n\n| Name | Location | Type | Description |\n| ---- | -------- | ---- |------------ |\n| `consistency_level` | query param | string | Optional consistency level: `ONE`, `QUORUM` (default) or `ALL`. |\n\nThe body requires the following fields:\n\n| Name | Type | Required | Description |\n| ---- | ---- | -------- | ----------- |\n| `match` | object | yes | Object outlining how to find the objects to be deleted (see example below) |\n| `output` | string | no | Optional verbosity level, `minimal` (default) or `verbose` |\n| `dryRun` | bool | no | If true, objects will not be deleted yet, but merely listed. Defaults to `false`. |\n\n#### A request body in detail\n\n```yaml\n{\n  \"match\": {\n    \"class\": \"\",  # required\n    \"where\": { /* where filter object */ },  # required\n  },\n  \"output\": \"\",  # Optional, one of \"minimal\" or \"verbose\". Defaults to \"minimal\".\n  \"dryRun\":   # Optional. If true, objects will not be deleted yet, but merely listed. Defaults to \"false\".\n}\n```\n\nPossible values for `output`:\n\n| Value | Effect |\n| ----- | ------ |\n| `minimal` | The result only includes counts. Information about objects is omitted if the deletes were successful. Only if an error occurred, will the object be described. |\n| `verbose` | The result lists all affected objects with their ID and deletion status, including both successful and unsuccessful deletes. |\n\n\n#### A response body in detail\n\n```yaml\n{\n  \"match\": {\n    \"class\": \"\",        # matches the request\n    \"where\": { /* where filter object */ },  # matches the request\n  },\n  \"output\": \"\",  # matches the request\n  \"dryRun\": ,\n  \"results\": {\n    \"matches\": \"\",            # how many objects were matched by the filter\n    \"limit\": \"\",              # the most amount of objects that can be deleted in a single query, matches QUERY_MAXIMUM_RESULTS\n    \"successful\": \"\",         # how many objects were successfully deleted in this round\n    \"failed\": \"\",             # how many objects should have been deleted but could not be deleted\n    \"objects\": [{                  # one JSON object per weaviate object\n      \"id\": \"\",                # this successfully deleted object would be omitted with output=minimal\n      \"status\": \"SUCCESS\",         # possible status values are: \"SUCCESS\", \"FAILED\", \"DRYRUN\"\n      \"error\": null\n    }, {\n      \"id\": \"\",                # this error object will always be listed, even with output=minimal\n      \"status\": \"FAILED\",\n      \"errors\": {\n         \"error\": [{\n             \"message\": \"\"\n         }]\n      }\n    }]\n  }\n}\n```\n\n\n### Example request\n\n\n\n\n## Error handling\n\nWhen sending a batch request to your Weaviate instance, it could be the case that an error occurs. This can be caused by several reasons, for example that the connection to Weaviate is lost or that there is a mistake in a single data object that you are trying to add.\n\nYou can check if an error occurred, and of what kind.\n\nA batch request will always return an HTTP `200` status code when the batch request was successful. That means that the batch was successfully sent to Weaviate, and there were no issues with the connection or processing of the batch, and the request was not malformed (`4xx` status code). However, with a `200` status code, there might still be individual failures of the data objects which are not contained in the response. Thus, a `200` status code does not guarantee that each batch item has been added/created. An example of an error on an individual data object that might be unnoticed by sending a batch request without checking the individual results is this: adding an object to the batch that is in conflict with the schema (for example a non-existing class name).\n\nThe following Python code can be used to handle errors on individual data objects in the batch.\n\n```python\nimport weaviate\n\nclient = weaviate.Client(\"http://localhost:8080\")\n\n\ndef check_batch_result(results: dict):\n  \"\"\"\n  Check batch results for errors.\n\n  Parameters\n  ----------\n  results : dict\n      The Weaviate batch creation return value, i.e. returned value of the client.batch.create_objects().\n  \"\"\"\n\n  if results is not None:\n    for result in results:\n      if 'result' in result and 'errors' in result['result']:\n        if 'error' in result['result']['errors']:\n          print(result['result']['errors']['error'])\n\nobject_to_add = {\n    \"name\": \"Jane Doe\",\n    \"writesFor\": [{\n        \"beacon\": \"weaviate://localhost/f81bfe5e-16ba-4615-a516-46c2ae2e5a80\"\n    }]\n}\n\nwith client.batch(batch_size=100, callback=check_batch_result) as batch:\n  batch.add_data_object(object_to_add, \"Author\", \"36ddd591-2dee-4e7e-a3cc-eb86d30a4303\")\n```\n\nThis can also be applied to adding references in batch. Note that sending batches, especially references, skips some validations at the object and reference level. Adding this validation on single data objects like above makes it less likely for errors to go undiscovered.\n\n\n\n\n\n", "type": "Documentation", "name": "rest-batch", "path": "developers/weaviate/api/rest/batch.md", "link": "https://weaviate.io/developers/weaviate/api/rest/batch", "timestamp": "2023-11-13 10:40:09", "reader": "JSON", "meta": {}, "chunks": []}